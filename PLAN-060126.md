# Game of Strife: Major Feature Implementation Plan

## Overview
Transform Game of Strife mobile app with 4 major improvements:
1. **Toroidal board edges** (wraparound connectivity)
2. **Super cell lives system** (configurable persistence)
3. **Enhanced super cell visuals** (distinct, exciting animations)
4. **80's arcade UI theme** (neon colors, bold design)
5. **Animation speed control** (user-adjustable slider)

## Executive Summary

**Performance Fix Achievement:** ‚úÖ COMPLETED
- Replaced 900 Pressable components with View during simulation
- Eliminated console logging overhead
- Animation now runs smoothly at 30fps on 30√ó30 boards
- Commit message should note: "May need slower animation for smaller boards - now addressed via speed slider"

**Scope:** 5 major feature additions across frontend and backend
**Estimated Changes:** ~15 files modified, 2 new files created
**Risk Level:** Medium (simulation logic changes require careful testing)
**Breaking Changes:** None (all changes are additive)

---

## Feature 1: Toroidal Board Edges (Wraparound Connectivity)

### Current Behavior
- Board edges are treated as dead cells (flat edges)
- Cells at edges have fewer neighbors (3-5 instead of 8)
- No wraparound - finite board with dead margin

### Target Behavior
- Top edge connects to bottom edge
- Left edge connects to right edge
- All cells have exactly 8 neighbors (Moore neighborhood)
- Standard Conway's Game of Life behavior

### Implementation

#### Files to Modify

**1. Frontend: `utils/gameTypes.ts`**
- Location: Lines 202-221 (getNeighbors function)
- Change: Add modulo arithmetic for wraparound

**Before:**
```typescript
if (newRow >= 0 && newRow < size && newCol >= 0 && newCol < size) {
  neighbors.push(board[newRow][newCol])
}
```

**After:**
```typescript
// Wraparound using modulo (toroidal topology)
const wrappedRow = (newRow + size) % size
const wrappedCol = (newCol + size) % size
neighbors.push(board[wrappedRow][wrappedCol])
```

**2. Backend: `server/src/engine/gameOfStrifeEngine.ts`**
- Location: Lines 443-462 (getNeighbors method)
- Change: Identical modulo arithmetic for consistency

**3. Settings: `stores/settingsStore.ts`**
- Add new setting: `enableToroidalBoard: boolean` (default: true)
- Add to DEFAULT_GAME_SETTINGS
- Persist in AsyncStorage

**4. Settings UI: `app/(tabs)/settings.tsx`**
- Add toggle switch: "Wraparound Board Edges"
- Description: "Board edges connect to opposite sides (standard Conway rules)"

### Testing Strategy
- Test edge cell behavior with token placement at corners
- Verify gliders can cross edges and reappear on opposite side
- Compare results between toroidal and flat modes

---

## Feature 2: Super Cell Lives System

### Current Behavior
- Superpowered cells die in one hit (same as normal cells)
- No persistence advantage beyond modified Conway rules

### Target Behavior
- Each superpower type has configurable lives (1-10)
- Cell loses 1 life when it would normally die
- Cell only truly dies when lives reach 0
- Lives counter visible on cell (optional UI indicator)

### Implementation

#### Data Structure Changes

**1. Extend Cell Interface: `utils/gameTypes.ts`**
```typescript
export interface Cell {
  player: number | null;
  alive: boolean;
  superpowerType: number;
  memory: number;
  lives: number;  // NEW: Current lives remaining (default: 1 for normal cells)
}
```

**2. Add Lives Configuration: `utils/gameTypes.ts`**
```typescript
export const DEFAULT_SUPERPOWER_LIVES: Record<number, number> = {
  0: 1,  // Normal cells
  1: 3,  // Tank - medium durability
  2: 2,  // Spreader - low durability
  3: 5,  // Survivor - high durability
  4: 1,  // Ghost - ethereal (no extra lives)
  5: 2,  // Replicator - low durability
  6: 4,  // Destroyer - high durability
  7: 3,  // Hybrid - medium durability
}
```

#### Simulation Logic Changes

**3. Frontend: `utils/gameTypes.ts` (simulateOneGeneration)**
- Location: Lines 176-278
- Modify death logic to decrement lives instead

**Current death logic:**
```typescript
if (!shouldCellLive(cell, aliveNeighbors, rules)) {
  nextCell.alive = false
}
```

**New logic:**
```typescript
if (!shouldCellLive(cell, aliveNeighbors, rules)) {
  if (cell.lives > 1) {
    // Cell survives death by spending a life
    nextCell.lives = cell.lives - 1
    nextCell.alive = true  // Stay alive
    nextCell.memory |= MEMORY_FLAGS.HAS_SURVIVED_DEATH
  } else {
    // Out of lives - truly dies
    nextCell.alive = false
    nextCell.lives = 0
  }
}
```

**4. Backend: `server/src/engine/gameOfStrifeEngine.ts`**
- Location: Lines 417-441 (simulateOneGeneration method)
- Apply identical lives logic
- Ensure Cell interface matches frontend

**5. Cell Initialization: Update all cell creation**
- `createEmptyBoard()` - initialize lives to 1
- `startPracticeMode()` - set lives from manifest
- `handlePlacement()` - assign lives based on superpowerType
- Server-side cell creation

#### Settings Integration

**6. Settings Store: `stores/settingsStore.ts`**
```typescript
interface GameSettings {
  // ... existing
  superpowerLives: Record<number, number>  // NEW: Lives per type (0-7)
}

export const DEFAULT_GAME_SETTINGS: GameSettings = {
  // ... existing
  superpowerLives: DEFAULT_SUPERPOWER_LIVES
}
```

**7. Settings UI: `app/(tabs)/settings.tsx`**
- Add "Superpower Lives" section
- For each enabled superpower type (1-7):
  - Display superpower name + icon
  - Number input for lives (1-10)
  - Default button to reset to defaults
- Show total lives budget (optional balancing metric)

**8. Settings Validation**
- Min: 1 life per type
- Max: 10 lives per type
- Normal cells (type 0) always have 1 life (not configurable)

### Visual Indicator (Optional)

**9. Lives Display on Cells: `components/GameBoard.tsx`**
- Option A: Small number badge on cell (e.g., "3" in corner)
- Option B: Opacity based on lives remaining (100% = full lives, fades as lives decrease)
- Option C: Border thickness indicates lives (thicker = more lives)

**Recommendation:** Option B (opacity) - subtle, doesn't clutter UI, clear visual feedback

---

## Feature 3: Enhanced Super Cell Visuals

### Current State
- Basic border styling (solid/dotted/dashed)
- Limited shadows on iOS/Android
- No animations
- Colors are muted and similar

### Target State
- **Distinct visual identity** for each superpower type
- **Animated effects** (pulsing, glowing, particle-like)
- **Bold neon colors** matching arcade theme
- **Clear differentiation** even at small cell sizes

### Implementation

#### Color Palette Design

**New Superpower Colors (Neon/Arcade):**
```typescript
// utils/colors.ts (NEW FILE)
export const ARCADE_COLORS = {
  // Player colors
  player1: '#00F5FF',      // Neon cyan
  player2: '#FF006E',      // Hot pink

  // Superpower colors
  tank: '#FFFFFF',         // Bright white (unchanged - works well)
  spreader: '#00F5FF',     // Neon cyan (enhanced from current)
  survivor: '#FFFF00',     // Electric yellow (more vibrant)
  ghost: '#FF10F0',        // Neon magenta (more vibrant purple)
  replicator: '#FF6600',   // Bright orange (more saturated)
  destroyer: '#FF0000',    // Pure red (more intense)
  hybrid: '#B026FF',       // Electric purple (more vibrant)

  // UI colors
  background: '#000000',   // Pure black
  surface: '#1A0033',      // Deep purple-black
  gridLines: '#330066',    // Dark purple
  text: '#00F5FF',         // Neon cyan
  textSecondary: '#FF10F0', // Neon magenta
  accent: '#FFFF00',       // Electric yellow
  danger: '#FF0000',       // Pure red
  success: '#00FF00',      // Neon green
}
```

#### Animation Strategy

**React Native Animation Approach:**
- Use `Animated` API for smooth 60fps effects
- Implement pulsing/glowing via opacity and scale animations
- Use `shadowRadius` changes for glow effects
- Avoid heavy transforms (rotation, complex paths)

**5 Animation Types (One per Superpower):**

1. **Tank (Type 1):** Solid, steady white glow
   - Constant shadow with occasional brightness pulse
   - Scale: 1.0 (no size change)

2. **Spreader (Type 2):** Pulsing cyan waves
   - Opacity: 0.7 ‚Üí 1.0 ‚Üí 0.7 (2s cycle)
   - Shadow radius: 2 ‚Üí 6 ‚Üí 2 (spreading effect)

3. **Survivor (Type 3):** Bright yellow steady glow
   - Shadow opacity: 0.6 ‚Üí 1.0 ‚Üí 0.6 (3s cycle)
   - Implies resilience through constant presence

4. **Ghost (Type 4):** Phase in/out magenta
   - Opacity: 0.3 ‚Üí 0.9 ‚Üí 0.3 (1.5s cycle)
   - Border style switches dotted/dashed randomly

5. **Replicator (Type 5):** Orange flash bursts
   - Scale: 1.0 ‚Üí 1.1 ‚Üí 1.0 (1s cycle, quick)
   - Shadow radius: 0 ‚Üí 4 ‚Üí 0 (burst effect)

6. **Destroyer (Type 6):** Aggressive red pulse
   - Border width: 3 ‚Üí 5 ‚Üí 3 (0.8s cycle, fast)
   - Intense shadow with high contrast

7. **Hybrid (Type 7):** Rainbow cycle through purple shades
   - Color shift: Purple ‚Üí Pink ‚Üí Purple (4s cycle)
   - Combines multiple subtle effects

#### Files to Modify

**1. Create Color Constants: `utils/colors.ts` (NEW FILE)**
```typescript
export const ARCADE_COLORS = { /* as defined above */ }
export const SUPERPOWER_COLORS = { /* superpower-specific */ }
```

**2. GameBoard Cell Styling: `components/GameBoard.tsx`**
- Replace StyleSheet superpower styles (lines 258-341)
- Import ARCADE_COLORS
- Implement animated styles using `Animated.Value`
- Add useEffect hooks to start/stop animations based on stage

**3. Animation Setup:**
```typescript
// Pseudocode for GameBoard.tsx
const useSuperpowerAnimation = (superpowerType: number, isSimulating: boolean) => {
  const animatedValue = useRef(new Animated.Value(0)).current

  useEffect(() => {
    if (isSimulating && superpowerType > 0) {
      // Start animation based on type
      const animation = Animated.loop(
        Animated.sequence([
          Animated.timing(animatedValue, {
            toValue: 1,
            duration: getDurationForType(superpowerType),
            useNativeDriver: false
          }),
          Animated.timing(animatedValue, {
            toValue: 0,
            duration: getDurationForType(superpowerType),
            useNativeDriver: false
          })
        ])
      )
      animation.start()
      return () => animation.stop()
    }
  }, [isSimulating, superpowerType])

  return animatedValue
}
```

**4. Performance Consideration:**
- Only animate during simulation (not during placement)
- Use `useNativeDriver: true` where possible (opacity, scale)
- Disable animations on boards > 20√ó20 (too many cells)
- Add setting to disable animations entirely

**5. Settings Addition: `app/(tabs)/settings.tsx`**
- Toggle: "Animate Superpower Cells" (default: true)
- Note: "Disable on large boards for better performance"

---

## Feature 4: 80's Arcade UI Theme

### Design Philosophy
- **Neon on black** - maximum contrast
- **Bold geometric shapes** - clear, chunky UI elements
- **Glowing effects** - simulate CRT phosphor glow
- **Limited palette** - 5-7 core neon colors only
- **High saturation** - no muted tones
- **Playful typography** - consider retro fonts (but keep readable)

### Color System

**Core Arcade Palette:**
```typescript
// utils/colors.ts
export const ARCADE_THEME = {
  // Backgrounds
  bg: {
    primary: '#000000',      // Pure black
    secondary: '#0D001A',    // Deep purple-black
    tertiary: '#1A0033',     // Purple-black surface
    card: '#220044',         // Purple card background
  },

  // Neon accents
  neon: {
    cyan: '#00F5FF',         // Primary neon (P1, links, active)
    pink: '#FF006E',         // Secondary neon (P2, highlights)
    yellow: '#FFFF00',       // Attention (warnings, selected)
    green: '#00FF00',        // Success states
    orange: '#FF6600',       // Info/neutral
    purple: '#B026FF',       // Special actions
    red: '#FF0000',          // Danger/errors
  },

  // Text
  text: {
    primary: '#FFFFFF',      // Pure white for headers
    secondary: '#00F5FF',    // Neon cyan for body
    tertiary: '#FF10F0',     // Neon magenta for hints
    disabled: '#666666',     // Dim gray
  },

  // Borders & dividers
  border: {
    default: '#00F5FF',      // Neon cyan
    active: '#FF006E',       // Hot pink
    disabled: '#333333',     // Dark gray
  },

  // Shadows (for glow effect)
  glow: {
    cyan: 'rgba(0, 245, 255, 0.8)',
    pink: 'rgba(255, 0, 110, 0.8)',
    yellow: 'rgba(255, 255, 0, 0.8)',
    purple: 'rgba(176, 38, 255, 0.8)',
  }
}
```

### Implementation Plan

#### Phase 1: Create Centralized Theme

**1. Create Theme File: `utils/theme.ts` (NEW FILE)**
```typescript
import { MD3DarkTheme } from 'react-native-paper'
import { ARCADE_THEME } from './colors'

// Keep current theme as DefaultTheme
export const DefaultTheme = {
  ...MD3DarkTheme,
  colors: {
    ...MD3DarkTheme.colors,
    primary: '#3B82F6',      // Blue (P1)
    secondary: '#10B981',    // Green (P2)
    background: '#111827',   // Very dark gray
    surface: '#1F2937',      // Dark gray
  }
}

// New arcade theme
export const ArcadeTheme = {
  ...MD3DarkTheme,
  colors: {
    ...MD3DarkTheme.colors,
    primary: ARCADE_THEME.neon.cyan,
    secondary: ARCADE_THEME.neon.pink,
    tertiary: ARCADE_THEME.neon.purple,
    background: ARCADE_THEME.bg.primary,
    surface: ARCADE_THEME.bg.tertiary,
    surfaceVariant: ARCADE_THEME.bg.card,
    onSurface: ARCADE_THEME.text.primary,
    onSurfaceVariant: ARCADE_THEME.text.secondary,
    outline: ARCADE_THEME.border.default,
    error: ARCADE_THEME.neon.red,
    onError: '#FFFFFF',
  },
  // Custom arcade colors for advanced styling
  arcade: ARCADE_THEME
}
```

**2. Apply Conditional Theme: `app/_layout.tsx`**
```typescript
import { ArcadeTheme, DefaultTheme } from '../utils/theme';
import { useSettingsStore } from '../stores/settingsStore';

export default function RootLayout() {
  const useArcadeTheme = useSettingsStore(state => state.settings.useArcadeTheme);
  const theme = useArcadeTheme ? ArcadeTheme : DefaultTheme;

  return (
    <PaperProvider theme={theme}>
      {/* ... */}
    </PaperProvider>
  );
}
```

**3. Add Theme Setting: `stores/settingsStore.ts`**
```typescript
interface GameSettings {
  // ... existing
  useArcadeTheme: boolean;  // NEW: Toggle arcade theme
}

export const DEFAULT_GAME_SETTINGS: GameSettings = {
  // ... existing
  useArcadeTheme: false  // Start with original theme (users can opt-in)
}
```

**4. Theme Toggle UI: `app/(tabs)/settings.tsx`**
```typescript
<View>
  <Text variant="titleMedium">Visual Theme</Text>
  <Switch
    value={useArcadeTheme}
    onValueChange={(value) => updateSettings({ useArcadeTheme: value })}
  />
  <Text>
    {useArcadeTheme ? "üéÆ 80's Arcade Mode" : "üìä Classic Mode"}
  </Text>
  <Text variant="bodySmall" style={styles.hint}>
    Toggle between neon arcade theme and classic professional theme
  </Text>
</View>
```

#### Phase 2: Update All Screen Styles

**Important:** All screen styles should reference `theme` object instead of hardcoded colors. This allows automatic switching between arcade and classic themes.

```typescript
// Example pattern for all screens:
import { useTheme } from 'react-native-paper';

const MyScreen = () => {
  const theme = useTheme();

  return (
    <View style={{ backgroundColor: theme.colors.background }}>
      <Text style={{ color: theme.colors.primary }}>Hello</Text>
    </View>
  );
};
```

**5. Lobby Screen: `app/(tabs)/index.tsx`**
- Replace all hardcoded colors with `theme.colors.*` references
- Update card backgrounds: `theme.colors.surfaceVariant`
- Update buttons: `theme.colors.primary`, `theme.colors.secondary`
- Glow effects: Use `theme.arcade.glow.*` (only when arcade theme active)
- Status indicator: `theme.arcade.neon.green` or fallback

**Changes:**
- Line 92: `backgroundColor: ARCADE_THEME.bg.primary`
- Lines 151-500+: Replace all inline hex colors with theme references
- Add shadow/glow to Create Room button
- Add border glow to active room cards

**4. Game Screen: `app/(tabs)/game.tsx`**
- Update container background: pure black
- Player cards: Add neon border glow (cyan for P1, pink for P2)
- Remove gray backgrounds, use pure black + neon accents

**5. Settings Screen: `app/(tabs)/settings.tsx`**
- Card backgrounds: `ARCADE_THEME.bg.card`
- Input fields: neon cyan borders
- Buttons: neon pink for primary actions
- Section headers: neon yellow text
- Add subtle glow to active elements

**6. Tab Bar: `app/(tabs)/_layout.tsx`**
- Active tab: neon cyan
- Inactive tab: dim gray
- Background: pure black
- Add glow effect to active tab icon

**7. Game Board: `components/GameBoard.tsx`**
- P1 cells: neon cyan fill
- P2 cells: hot pink fill
- Empty cells: deep purple-black
- Grid lines: dark purple (subtle)
- Selected cell: electric yellow border + glow

**8. Game HUD: `components/GameHUD.tsx`**
- Player info cards: neon-bordered cards
- Token counts: large neon numbers
- Generation counter: neon yellow
- Turn indicator: pulsing neon glow

#### Phase 3: Add Glow Effects

**9. Glow Helper Function: `utils/theme.ts`**
```typescript
export const createGlow = (color: string, radius: number = 10) => ({
  shadowColor: color,
  shadowOffset: { width: 0, height: 0 },
  shadowOpacity: 0.8,
  shadowRadius: radius,
  elevation: radius, // Android
})
```

**10. Apply Glows:**
- Primary buttons: cyan glow
- Secondary buttons: pink glow
- Active elements: yellow glow
- Player indicators: player-colored glow
- Selected cells: yellow glow
- Superpower cells: type-specific glow

### Typography Considerations

**Current:** System default (SF Pro on iOS, Roboto on Android)
**Option 1:** Keep system font for readability (RECOMMENDED)
**Option 2:** Use retro-style font (e.g., "Press Start 2P") - may hurt readability
**Recommendation:** Stick with system fonts, use BOLD weights and UPPERCASE for arcade feel

---

## Feature 5: Animation Speed Control

### Implementation

**1. Add Speed Setting: `stores/settingsStore.ts`**
```typescript
interface GameSettings {
  // ... existing
  animationSpeed: number  // NEW: FPS (10-60), default: 30
}

export const DEFAULT_GAME_SETTINGS: GameSettings = {
  // ... existing
  animationSpeed: 30  // 30fps default (balanced)
}
```

**2. Use Speed in Simulation: `components/GameOfStrife.tsx`**
```typescript
// Line 204 - replace hardcoded 33ms
const animationSpeed = useSettingsStore(state => state.settings.animationSpeed)
const frameInterval = 1000 / animationSpeed  // Convert fps to ms

simulationTimerRef.current = setTimeout(animateNextFrame, frameInterval)
```

**3. Settings UI: `app/(tabs)/settings.tsx`**
```typescript
// Add slider control with snap points
const SPEED_PRESETS = [15, 20, 30, 45, 60]; // Snap points

<View>
  <Text>Animation Speed: {animationSpeed} FPS</Text>
  <Slider
    minimumValue={10}
    maximumValue={60}
    step={1}  // Allow fine control
    value={animationSpeed}
    onValueChange={(value) => {
      // Snap to preset if within 2 fps
      const nearestPreset = SPEED_PRESETS.find(preset =>
        Math.abs(preset - value) <= 2
      );
      updateSettings({
        animationSpeed: nearestPreset || value
      });
    }}
  />
  <View style={styles.presetMarkers}>
    {SPEED_PRESETS.map(preset => (
      <Text key={preset} style={styles.presetLabel}>{preset}</Text>
    ))}
  </View>
  <Text>Slower ‚Üê ‚Üí Faster</Text>
</View>
```

**Implementation Notes:**
- Slider snaps to presets: 15 (slow), 20, 30 (default), 45, 60 (fast)
- Snap threshold: ¬±2 fps around preset values
- Visual markers show preset positions on slider track

---

## Implementation Order & Risk Management

### Phase 1: Low-Risk Foundation (Week 1)
1. ‚úÖ Create color constants file (`utils/colors.ts`)
2. ‚úÖ Create theme file (`utils/theme.ts`)
3. ‚úÖ Apply global theme to `app/_layout.tsx`
4. ‚úÖ Add animation speed slider to settings
5. ‚úÖ Add toroidal board toggle to settings

**Risk:** Minimal - additive changes only
**Testing:** Visual inspection, no logic changes

### Phase 2: Simulation Logic Changes (Week 1-2)
1. ‚ö†Ô∏è Extend Cell interface with `lives` field
2. ‚ö†Ô∏è Implement toroidal neighbor lookup (frontend + backend)
3. ‚ö†Ô∏è Implement lives system in simulation logic (frontend + backend)
4. ‚ö†Ô∏è Update all cell creation/initialization points

**Risk:** Medium - core game logic changes
**Testing:**
- Unit tests for getNeighbors (toroidal vs flat)
- Integration tests for lives system
- Compare frontend/backend simulation results
- Test edge cases (corners, zero lives, high lives)

### Phase 3: Visual Enhancements (Week 2)
1. ‚úÖ Update lobby screen colors
2. ‚úÖ Update game screen colors
3. ‚úÖ Update settings screen colors
4. ‚úÖ Update game board cell colors
5. ‚úÖ Add glow effects to UI elements
6. ‚ö†Ô∏è Implement superpower animations (performance-critical)

**Risk:** Low-Medium - visual only, but animations can impact performance
**Testing:**
- Performance profiling on large boards (30√ó30)
- Test on low-end devices
- Toggle animations on/off
- Check battery impact

### Phase 4: Settings Integration (Week 2-3)
1. ‚úÖ Add superpower lives configuration UI
2. ‚úÖ Add lives count validation
3. ‚úÖ Persist all new settings
4. ‚úÖ Add animation toggle

**Risk:** Low - UI changes only
**Testing:** Settings persistence, validation rules

---

## Files Changed Summary

### New Files (2)
- `utils/colors.ts` - Arcade color palette constants
- `utils/theme.ts` - Theme configuration + glow helpers

### Modified Files (13)

**Core Logic:**
1. `utils/gameTypes.ts` - Cell interface, lives system, toroidal edges
2. `server/src/engine/gameOfStrifeEngine.ts` - Backend simulation matching frontend

**Settings:**
3. `stores/settingsStore.ts` - Add animationSpeed, superpowerLives, enableToroidalBoard
4. `app/(tabs)/settings.tsx` - UI for all new settings

**Theme/Styling:**
5. `app/_layout.tsx` - Apply ArcadeTheme globally
6. `app/(tabs)/_layout.tsx` - Tab bar colors
7. `app/(tabs)/index.tsx` - Lobby screen arcade styling
8. `app/(tabs)/game.tsx` - Game screen arcade styling

**Game Components:**
9. `components/GameOfStrife.tsx` - Use animation speed setting
10. `components/GameBoard.tsx` - Arcade colors, animations, lives display
11. `components/GameHUD.tsx` - Arcade colors, neon effects

**Server Types:**
12. `server/src/types/game.ts` - Add lives to Cell interface
13. `server/src/engine/gameOfStrifeTypes.ts` - Update Cell type

---

## Testing Checklist

### Toroidal Edges
- [ ] Place token at top edge, verify it has bottom neighbors
- [ ] Place token at corner, verify it has 8 neighbors (wraparound)
- [ ] Run glider pattern, verify it wraps around edges
- [ ] Toggle toroidal on/off, verify behavior changes
- [ ] Compare frontend/backend simulation results (must match)

### Lives System
- [ ] Configure different lives per superpower type
- [ ] Place superpower cells, verify they survive extra deaths
- [ ] Verify lives counter decrements correctly
- [ ] Verify cell dies when lives reach 0
- [ ] Test with 1 life (normal behavior)
- [ ] Test with 10 lives (max persistence)
- [ ] Verify HAS_SURVIVED_DEATH memory flag set
- [ ] Compare frontend/backend simulation results (must match)

### Animations
- [ ] Test all 7 superpower animations
- [ ] Verify animations only run during simulation
- [ ] Test on 10√ó10 board (smooth)
- [ ] Test on 30√ó30 board (smooth or auto-disabled)
- [ ] Toggle animations on/off in settings
- [ ] Check battery/CPU impact
- [ ] Verify no performance regression from previous optimization

### UI Theme
- [ ] Check all screens for consistent arcade theme
- [ ] Verify neon colors are vibrant and distinct
- [ ] Check glow effects on iOS and Android
- [ ] Test in dark environment (glow should be visible)
- [ ] Verify readability (text contrast)
- [ ] Check accessibility (color blindness, high contrast mode)

### Animation Speed
- [ ] Test slider at 10 fps (slow)
- [ ] Test slider at 30 fps (default)
- [ ] Test slider at 60 fps (fast)
- [ ] Verify small boards feel appropriate
- [ ] Verify large boards feel appropriate
- [ ] Test speed persistence across app restarts

---

## Migration & Backwards Compatibility

### Data Migration
- Existing games/settings have no `lives` field in cells
- **Solution:** Default to 1 life for any cell missing `lives`
- **Solution:** Initialize `superpowerLives` from defaults if not present
- **Solution:** Initialize `animationSpeed` to 30 if not present
- **Solution:** Initialize `enableToroidalBoard` to true (new standard)

### Server Compatibility
- Backend must support both old and new Cell format
- **Solution:** Check for `lives` field, default to 1 if missing
- **Solution:** Version the protocol if needed (add protocolVersion to matchState)

---

## Success Criteria

**Feature 1: Toroidal Edges** ‚úÖ
- Board edges wrap correctly
- All cells have 8 neighbors
- Toggle setting works
- No performance impact

**Feature 2: Lives System** ‚úÖ
- Lives configurable per superpower type (1-10)
- Cells survive extra deaths based on lives
- Lives decrement correctly
- Visual indicator (opacity) works
- No simulation desync between frontend/backend

**Feature 3: Enhanced Visuals** ‚úÖ
- 7 distinct superpower animations implemented
- Neon colors are vibrant and distinct
- Animations run smoothly (no jank)
- Performance acceptable on large boards
- Toggle to disable works

**Feature 4: Arcade Theme** ‚úÖ
- All screens use neon-on-black aesthetic
- Glow effects visible and appealing
- High contrast, readable text
- Consistent theme across all UI
- No hardcoded colors remaining

**Feature 5: Speed Control** ‚úÖ
- Animation speed slider works (10-60 fps)
- Speed persists across restarts
- Smooth animation at all speeds
- Appropriate defaults for different board sizes

---

## Performance Notes

**Previous Optimization (Completed):**
- Replaced Pressable with View during simulation
- Removed console logging
- Achieved 30fps on 30√ó30 boards

**New Performance Considerations:**
1. **Animations:** May slow down large boards - add auto-disable threshold
2. **Lives Tracking:** Minimal overhead (one integer per cell)
3. **Toroidal Math:** Modulo operations are fast - negligible impact
4. **Theme Glow Effects:** Shadows can be expensive on Android - use sparingly

**Recommended Safeguards:**
- Disable animations on boards > 25√ó25
- Limit glow effects to 5-10 elements per screen
- Use native driver for animations where possible
- Profile on mid-range Android device (Galaxy A series)

---

## Notes for Implementation

1. **Start with colors/theme** - most visible impact, lowest risk
2. **Implement toroidal edges + lives** together - they both touch simulation logic
3. **Add animations last** - performance-sensitive, can be toggled off
4. **Test extensively on Android** - glow effects and animations are more expensive
5. **Keep settings granular** - users can disable features if needed
6. **Document all new settings** - add help text in UI

---

## Decisions Made

1. **Lives indicator:** Only visible during simulation (less clutter, lives only matter during simulation)

2. **Arcade theme:** Toggleable in settings (users can choose between arcade and original theme)

3. **Animation speed control:** Slider with snap points at preset values (15, 20, 30, 45, 60 fps)
   - Slider "sticks" at preset amounts for easy selection
   - Users can still fine-tune between presets if needed

4. **Toroidal mode default:** Yes (standard Conway behavior)

---

## Commit Strategy

**Suggested Commits:**
1. "Add arcade color palette and theme system"
2. "Implement animation speed slider in settings"
3. "Add toroidal board edge support (wraparound connectivity)"
4. "Implement configurable superpower lives system"
5. "Apply arcade theme to lobby and settings screens"
6. "Apply arcade theme to game screen and components"
7. "Add superpower cell animations with performance toggles"
8. "Update settings UI for lives configuration and toggles"

Each commit should be independently testable and deployable.

---

## Testing Notes & Updates (January 2026)

### Phase 1 & 2 Implementation Status

**‚úÖ COMPLETED:**
1. Arcade color palette and theme system (utils/colors.ts, utils/theme.ts)
2. Settings infrastructure with new fields (settingsStore.ts)
3. Settings UI controls (app/(tabs)/settings.tsx)
4. Animation speed control integrated into GameOfStrife component
5. Toroidal board edges (frontend + backend)
6. Lives system infrastructure (Cell interface extended, simulation logic updated)

**üêõ BUGS FIXED:**
1. Settings store backwards compatibility - merged with defaults to prevent undefined fields
2. Settings initialization - added loadSettings() call on app startup
3. Slider package missing - installed @react-native-community/slider

**üìù TESTING RESULTS:**

**Animation Speed Slider:**
- ‚ùå Snap-to-presets feature REMOVED (user feedback: not working as expected)
- ‚ö†Ô∏è Hard to judge effectiveness on small boards (too fast to notice difference)
- üìå **RECOMMENDATION:** Focus on slowing down animation, not speeding up
  - Users want to see the simulation play out
  - Fast playback makes games quick but loses visual appeal
  - Add to final polish list - may remove slider if not effective

**Toroidal Board:**
- ‚úÖ WORKING - edges wrap correctly to opposite sides
- ‚úÖ Confirmed with edge token placement tests

**Settings Persistence:**
- ‚úÖ WORKING in dev environment (persists between games and app reloads)
- ‚è≥ Full persistence test deferred to production build

**Lives System:**
- ‚ö†Ô∏è **CRITICAL ISSUE:** Lives currently applied to ALL cells (incorrect!)
  - Lives should ONLY apply to superpowered cells based on their type
  - Normal cells (superpowerType: 0) should always have 1 life
  - Tank (type 1) should have 3 lives, Survivor (type 3) should have 5 lives, etc.
- ‚úÖ Lives display added - shows number in center of cells during simulation
- ‚úÖ Lives display persists through simulation
- üìå **TODO:** Wire up superpower-specific lives from settings.superpowerLives

**Decisions Updated:**
3. **Animation speed control:** Simple slider (NO snap points)
   - Range: 10-60 fps
   - No preset snapping (removed based on testing)
   - Focus on providing slower speeds for better visualization

**Lives Display Implementation:**
- Shows lives count as white text in center of cells
- Only displays for alive cells with lives > 0
- Visible during both placement and simulation phases
- Positioned absolutely to center in cell
- Font: 12px bold white text
